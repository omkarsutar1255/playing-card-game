<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<script>
  let peer;
  let conn;

  function log(msg) {
    document.getElementById("log").innerText += msg + "\n";
  }

  function createHost() {
    log("Creating host...");
    peer = new Peer(undefined, {
      debug: 2
    });

    peer.on('open', id => {
      document.getElementById("roomId").innerText = id;
      log("Host ID: " + id);
    });

    peer.on('connection', c => {
      conn = c;
      log("Client connected");

      conn.on('data', data => {
        log("Received: " + data);
      });
    });

    peer.on('error', err => {
      log("Peer error: " + err);
    });
  }

  function joinHost() {
    const roomId = document.getElementById("joinId").value.trim();
    if (!roomId) {
      log("Enter Room ID first");
      return;
    }

    log("Joining host...");
    peer = new Peer(undefined, {
      debug: 2
    });

    peer.on('open', () => {
      log("My peer created, connecting...");
      conn = peer.connect(roomId);

      conn.on('open', () => {
        log("Connected to host");
      });

      conn.on('data', data => {
        log("Received: " + data);
      });

      conn.on('error', err => {
        log("Connection error: " + err);
      });
    });

    peer.on('error', err => {
      log("Peer error: " + err);
    });
  }

  function sendMsg() {
    if (!conn || !conn.open) {
      log("Not connected yet");
      return;
    }
    const msg = document.getElementById("msg").value;
    conn.send(msg);
    log("Sent: " + msg);
  }
</script>
