<!DOCTYPE html>
<html>
<head>
  <title>P2P Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <h2>P2P Browser Test</h2>

  <button onclick="createHost()">Create Host</button>
  <p>Room ID: <span id="roomId">---</span></p>

  <hr>

  <input id="joinId" placeholder="Enter Room ID">
  <button onclick="joinHost()">Join Host</button>

  <hr>

  <input id="msg" placeholder="Type message">
  <button onclick="sendMsg()">Send</button>

  <pre id="log"></pre>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<script>
  let peer;
  let conn;

  function log(msg) {
    document.getElementById("log").innerText += msg + "\n";
  }

  function createHost() {
    log("Creating host...");
    peer = new Peer(undefined, {
      debug: 2
    });

    peer.on('open', id => {
      document.getElementById("roomId").innerText = id;
      log("Host ID: " + id);
    });

    peer.on('connection', c => {
      conn = c;
      log("Client connected");

      conn.on('data', data => {
        log("Received: " + data);
      });
    });

    peer.on('error', err => {
      log("Peer error: " + err);
    });
  }

  function joinHost() {
    const roomId = document.getElementById("joinId").value.trim();
    if (!roomId) {
      log("Enter Room ID first");
      return;
    }

    log("Joining host...");
    peer = new Peer(undefined, {
      debug: 2
    });

    peer.on('open', () => {
      log("My peer created, connecting...");
      conn = peer.connect(roomId);

      conn.on('open', () => {
        log("Connected to host");
      });

      conn.on('data', data => {
        log("Received: " + data);
      });

      conn.on('error', err => {
        log("Connection error: " + err);
      });
    });

    peer.on('error', err => {
      log("Peer error: " + err);
    });
  }

  function sendMsg() {
    if (!conn || !conn.open) {
      log("Not connected yet");
      return;
    }
    const msg = document.getElementById("msg").value;
    conn.send(msg);
    log("Sent: " + msg);
  }
</script>
</body>
</html>
